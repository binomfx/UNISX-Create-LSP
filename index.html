<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>LSP Creator</title>
        <style>
            .line {
                border-bottom: 2px solid #000; /* Параметры линии */
                vertical-align: center;
            }
            .lntxt {overflow:hidden}
            .lntxt:before,.lndot:after {
                content:'';display:inline-block;vertical-align:middle;
                box-sizing:border-box;width:100%;height:2px;
                background:rgb(230,235,235); 
                border:solid #FFF;
                 border-width:0 .5em 0;
            }
            .lntxt:before {margin-left:-100%}
            .lntxt:after {margin-right:-100%}
            .status1 {
                width: 100%;
                color: white;
                background: black;
                border-spacing: 0px;
                padding: 0px;
            }
            .status2 {
                text-align: right;
                vertical-align: center;
                padding: 0px;
            }
            .logo {
                width: 0;
                text-align: left;
            }
            .val1 {
                width: 0;
                background: red; 
                text-align: left;
                white-space: nowrap;
            }
        </style>
    </head>

    
    <!-- ************************************************************************* -->    
    <!-- ************************************************************************* -->    
    <!-- ************************************************************************* -->    
    <body>
    
    <!-- ************************************************************************* -->    
    <!--                           Подключить кошелек Metamask                     -->    
    <!-- ************************************************************************* -->    
        <script>
            
            let network= 'none 1'
            let user_address = 'none 2'
            let web3 = null
            let provider = null

            
<!-------------------------------------------------------------------------------------->            
            async function connectWallet () {
                if (window.ethereum) { // проверяем есть ли кошелек
                    // сохраняем экземпляр для дальнейшей инициализации web3Provider
                    provider = window.ethereum 
                    window.ethereum.enable().then((accounts) => {
                        user_address = accounts[0];
                        localStorage.setItem("user_address",user_address);
                    });
                    if (user_address == null) {
                        return
                    }
                } else if (window.web3) {
                    provider = window.web3.currentProvider
                }
                if (provider) {
                    // инициалзируем web3 provider
                    //web3 = new ethers.providers.Web3Provider(provider, 'any')
                    localStorage.setItem("networkId",await provider.request({ method: 'net_version' }));
                    //const networkId = await provider.request({ method: 'net_version' });
                    //console.log('networkId=');
                    //console.log(networkId);
                    switch (localStorage.getItem("networkId")) {
                            case "1":
                                    network = "Ethereum Mainnet";
                                    break;
                            case "3":
                                    network = "Ropsten Testnet";
                                    break;
                            case "4":
                                    network = "Rinkeby Testnet";
                                    break;
                            case "5":
                                    network = "Goerli Testnet";
                                    break;
                            case "42":
                                    network = "Kovan Testnet";
                                    break;
                            case "56":
                                    network = "BSC";
                                    break;
                            default:
                                    network = "Unknown Network";
                    }
                    localStorage.setItem("network",network);
                }
                location.reload();
            }

            
            function checkWallet() {
                console.log(window.ethereum.isConnected());
                if (window.ethereum && window.ethereum.isConnected()) {
                    console.log('Metamask is connected!');
                    window.ethereum.enable().then((accounts) => {
                            user_address = accounts[0];
                    });
                   switch (parseInt(window.ethereum.chainId)) {
                            case "1":
                                    network = "Ethereum Mainnet";
                                    break;
                            case "3":
                                    network = "Ropsten Testnet";
                                    break;
                            case "4":
                                    network = "Rinkeby Testnet";
                                    break;
                            case "5":
                                    network = "Goerli Testnet";
                                    break;
                            case "42":
                                    network = "Kovan Testnet";
                                    break;
                            default:
                                    network = "Unknown Network";
                    }
                } else {
                      console.log('Metamask is not connected!');
                }
            }
            
            function getNetwork() {
                network = localStorage.getItem("network");
                console.log('network=');
                console.log(network);
                return (network);
            }
                
            function getUserAddress() {
                user_address = localStorage.getItem("user_address");
                console.log('user_address=');
                console.log(user_address);
                return (user_address);
            }
    
            
        </script>    
        
        
    <!-- Строка состояния показывает наименование сети, адрес подключенного кошелька и кнопку подключения кошелька -->    
    <table class="status1">
        <tr class="status2">
            <td class="logo">LSP</td>
            <td>Network:</td>
            <td class="val1"><script type="text/javascript">document.write (getNetwork());</script></td>
            <td>Address:</td>
            <td class="val1"><script type="text/javascript">document.write (getUserAddress());</script></td>
            <td><button onclick="connectWallet();">Connect</button></td>
        </tr>
    </table>

        
    <!-- Параметры синтетика -->    
    <h2 class="lntxt">Synt Parameters</h2>
    <hr />
	<small>
	<table bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0" style="width:1000px">
	<tbody>
		<tr>
			<td>
			<p>Name of the long short pair contract</p>
			<p><input maxlength="25" name="pairName" required="required" size="25" type="text" /></p>
			</td>
			<td>
			<p>Synth Symbol (4 chars)</p>
			<p><input maxlength="4" name="syntSymbol" required="required" size="25" type="text" /></p>
			</td>
			<td>
			<p>Name of registered price identifier</p>
			<p><input maxlength="25" name="priceID" required="required" size="25" type="text" /></p>
			</td>
		</tr>
		<tr>
			<td>
			<p>Name of the long synthetic token to be created:</p>
			<p>Symbol of the long synthetic token to be created:</p>
			<p>Name of the short synthetic token to be created:</p>
			<p>Symbol of the short synthetic token to be created:</p>
			</td>
			<td>
			<p>longSynthName</p>
			<p>longSynthSymbol</p>
			<p>shortSynthName</p>
			<p>shortSynthSymbol</p>
			</td>
			<td>
			<p>Expiration timestamp (Unix format)</p>
			<p><input maxlength="25" name="expirationTimestamp" required="required" size="25" type="text" /></p>
			<p>Payout logic contract</p>
			<p><select name="financialProductLibrary" required="required">
				<option value="1">Linear LSP</option>
				<option value="2">Covered call LSP</option>
				<option value="3">Floored linear LSP</option>
				<option value="4">Binary options LSP</option></select></p>
			</td>
		</tr>
		<tr>
			<td>
			<p>Address of collateral token contract&nbsp; &nbsp;&nbsp;</p>

			<p><input maxlength="45" name="collateralToken" required="required" size="25" type="text" /></p>
			</td>
			<td>
			<p>Collateral requirements to mint one pair of synthetics tokens</p>

			<p><input maxlength="25" name="collaterlPerPair" required="required" size="25" type="text" /></p>
			</td>
			<td>&nbsp;</td>
		</tr>
	</tbody>
    </table>
    </small>
    <p>&nbsp;</p>
        
    <!-- Параметры оракула -->    
    <h2 class="lntxt">OO Parameters</h2>
    <hr />
    <small>
    <p>Optimistic oracle reward amount, pulled from the caller of the expire function</p>
    <p><input maxlength="25" name="proposerReward" size="25" type="text" /></p>
    <p>Optimistic oracle liveness time for price requests</p>
    <p><input maxlength="25" name="optimisticOracleLivenessTime" size="25" type="text" /></p>
    <p>Optimistic oracle proposer bond for price requests</p>
    <p><input maxlength="25" name="jptimisticOracleProposerBond" size="25" type="text" /></p>
    </small>


    <!-- Деплой синтетика -->    
    <h2 class="lntxt">Create</h2>
    <hr />
    <small>
    <p><input name="CreateButton" type="button" value="Create" />&nbsp;&nbsp;<input name="CancelButton" type="button" value="Cancel" />&nbsp;</p>
    <p>Address of the long short pair contract:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lspContractAddress</p>
    <p>Address of the long synthetic token contract:&nbsp; &nbsp; &nbsp;longTokenContractAddress</p>
    <p>Address of the short&nbsp;synthetic token contract:&nbsp; &nbsp; &nbsp;shortTokenContractAddress</p>
    </small>

    </body>
</html>
